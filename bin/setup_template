#!/usr/bin/env ruby

puts "ï¿½ Digital Autobiography Template Setup"
puts "=" * 50
puts

# Check Ruby version
ruby_version = RUBY_VERSION
puts "ğŸ” Checking Ruby version..."
if ruby_version < "3.0"
  puts "âŒ Ruby #{ruby_version} detected. Please upgrade to Ruby 3.0 or higher."
  puts "   Visit: https://rubyinstaller.org/ (Windows) or use brew/apt (Mac/Linux)"
  exit 1
else
  puts "âœ… Ruby #{ruby_version} - Perfect!"
end

# Check Rails
puts "ğŸ” Checking Rails..."
begin
  require 'rails/version'
  rails_version = Rails.version
  puts "âœ… Rails #{rails_version} - Great!"
rescue LoadError
  puts "âŒ Rails not found. Installing Rails..."
  system("gem install rails") or begin
    puts "Failed to install Rails. Please run: gem install rails"
    exit 1
  end
  puts "âœ… Rails installed successfully!"
end

# Check for Node.js and Yarn
puts "ğŸ” Checking Node.js and Yarn..."
if system("node --version > /dev/null 2>&1")
  puts "âœ… Node.js - Good!"
else
  puts "âŒ Node.js not found. Please install from: https://nodejs.org/"
  exit 1
end

if system("yarn --version > /dev/null 2>&1")
  puts "âœ… Yarn - Good!"
else
  puts "âŒ Yarn not found. Installing Yarn..."
  system("npm install -g yarn") or begin
    puts "Failed to install Yarn. Please run: npm install -g yarn"
    exit 1
  end
end

puts
puts "ğŸ“¦ Installing dependencies..."
puts "   This may take a few minutes..."

# Install gems
print "   Installing Ruby gems... "
if system("bundle install > /dev/null 2>&1")
  puts "âœ…"
else
  puts "âŒ"
  puts "Failed to install gems. Please check your internet connection and try again."
  exit 1
end

# Install JavaScript dependencies
print "   Installing JavaScript packages... "
if system("yarn install > /dev/null 2>&1")
  puts "âœ…"
else
  puts "âŒ"
  puts "Failed to install JavaScript packages. Please check your internet connection."
  exit 1
end

puts
puts "ğŸ—„ï¸ Setting up database..."

# Setup database
print "   Creating database... "
if system("rails db:create > /dev/null 2>&1")
  puts "âœ…"
else
  puts "âŒ"
  puts "Database creation failed. Check the troubleshooting guide."
  exit 1
end

print "   Running migrations... "
if system("rails db:migrate > /dev/null 2>&1")
  puts "âœ…"
else
  puts "âŒ"
  puts "Migration failed. Check the troubleshooting guide."
  exit 1
end

print "   Adding sample content... "
if system("rails db:seed > /dev/null 2>&1")
  puts "âœ…"
else
  puts "âŒ"
  puts "Seeding failed. Check the troubleshooting guide."
  exit 1
end

puts
puts "ï¿½ Setup Complete!"
puts "=" * 50
puts
puts "ğŸš€ Next steps:"
puts "1. Start the server:"
puts "   rails server"
puts
puts "2. Open your browser and visit:"
puts "   http://localhost:3000"
puts
puts "3. Sign in with these credentials:"
puts "   Email: admin@example.com"
puts "   Password: password123"
puts "   (Change these after first login!)"
puts
puts "4. Start customizing your autobiography:"
puts "   â€¢ Add your own chapters and content"
puts "   â€¢ Upload your photos"
puts "   â€¢ Try the different themes"
puts "   â€¢ Customize colors and styling"
puts
puts "ğŸ“š Documentation:"
puts "   â€¢ README.md - Overview and features"
puts "   â€¢ docs/CUSTOMIZATION.md - How to customize"
puts "   â€¢ docs/TROUBLESHOOTING.md - Fix common issues"
puts
puts "ğŸ†˜ Need help? Check docs/TROUBLESHOOTING.md or create a GitHub issue"
puts
puts "Happy autobiography writing! ğŸ“–âœ¨"
puts "ğŸ“– Read CUSTOMIZATION.md for styling instructions"
puts "ğŸš€ Happy writing!"
